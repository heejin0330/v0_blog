{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/cording/PJT_JAEHAN/v0_blog/app/api/content/generate/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport { GoogleGenerativeAI } from \"@google/generative-ai\";\n\n// 1. Google Gemini 클라이언트 설정\n// 여러 환경 변수 이름 지원: GEMINI_API_KEY, GOOGLE_GEMINI_API_KEY, GOOGLE_API_KEY\nconst apiKey =\n  process.env.GEMINI_API_KEY ||\n  process.env.GOOGLE_GEMINI_API_KEY ||\n  process.env.GOOGLE_API_KEY ||\n  \"\";\n\nif (!apiKey) {\n  console.error(\n    \"Gemini API 키가 설정되지 않았습니다. 다음 환경 변수 중 하나를 설정해주세요:\"\n  );\n  console.error(\"- GEMINI_API_KEY\");\n  console.error(\"- GOOGLE_GEMINI_API_KEY\");\n  console.error(\"- GOOGLE_API_KEY\");\n}\n\nconst genAI = new GoogleGenerativeAI(apiKey);\n\n// 섹션 타입 정의\ninterface Section {\n  type: \"h1\" | \"h2\" | \"h3\" | \"p\" | \"ul\";\n  content: string | string[];\n}\n\n// [핵심 함수] JSON 데이터를 워드프레스 구텐베르크 블록 포맷으로 변환\nfunction convertToWPBlocks(sections: Section[]): string {\n  return sections\n    .map((section) => {\n      switch (section.type) {\n        case \"h1\":\n          return `\\n<h1>${String(section.content)}</h1>\\n`;\n\n        case \"h2\":\n          return `\\n<h2>${String(section.content)}</h2>\\n`;\n\n        case \"h3\":\n          return `\\n<h3>${String(section.content)}</h3>\\n`;\n\n        case \"p\":\n          return `\\n<p>${String(section.content)}</p>\\n`;\n\n        case \"ul\":\n          // 리스트 아이템 처리\n          const listItems = Array.isArray(section.content)\n            ? section.content.map((item: string) => `<li>${item}</li>`).join(\"\")\n            : `<li>${String(section.content)}</li>`;\n          return `\\n<ul>${listItems}</ul>\\n`;\n\n        default:\n          return `\\n<p>${String(section.content)}</p>\\n`;\n      }\n    })\n    .join(\"\\n\\n\"); // 블록 사이에 줄바꿈 추가\n}\n\n// SEO 점수 계산 함수 (Rank Math 기준)\nfunction calculateSEOScore(\n  title: string,\n  metaDescription: string,\n  content: string,\n  images: Array<{ alt: string; url?: string }>,\n  keywords: string[]\n): number {\n  let score = 0;\n  const maxScore = 100;\n\n  // 주요 키워드 (첫 번째 키워드 사용)\n  const primaryKeyword = keywords[0] || \"\";\n\n  // 1. 제목 최적화 (20점)\n  const titleLength = title.length;\n  if (titleLength >= 30 && titleLength <= 60) {\n    score += 10; // 길이 적절 (30-60자)\n  } else if (titleLength > 60 && titleLength <= 70) {\n    score += 7; // 약간 김 (60-70자)\n  } else if (titleLength > 20 && titleLength < 30) {\n    score += 7; // 약간 짧음\n  } else {\n    score += 3; // 너무 짧거나 김\n  }\n\n  // 키워드가 제목에 포함되어 있는지\n  if (\n    primaryKeyword &&\n    title.toLowerCase().includes(primaryKeyword.toLowerCase())\n  ) {\n    score += 10; // 키워드 포함\n  } else {\n    // 키워드의 일부라도 포함되어 있는지 확인\n    const keywordWords = primaryKeyword.split(\" \").filter((w) => w.length > 2);\n    const hasPartialKeyword = keywordWords.some((word) =>\n      title.toLowerCase().includes(word.toLowerCase())\n    );\n    if (hasPartialKeyword) {\n      score += 5;\n    }\n  }\n\n  // 2. 메타 설명 최적화 (15점)\n  const metaLength = metaDescription.length;\n  if (metaLength >= 120 && metaLength <= 155) {\n    score += 10; // 길이 적절 (120-155자)\n  } else if (metaLength >= 100 && metaLength < 120) {\n    score += 7; // 약간 짧음\n  } else if (metaLength > 155 && metaLength <= 160) {\n    score += 7; // 약간 김\n  } else {\n    score += 3; // 너무 짧거나 김\n  }\n\n  // 키워드가 메타 설명에 포함되어 있는지\n  if (\n    primaryKeyword &&\n    metaDescription.toLowerCase().includes(primaryKeyword.toLowerCase())\n  ) {\n    score += 5; // 키워드 포함\n  }\n\n  // 3. 콘텐츠 길이 (15점)\n  const contentText = content.replace(/<[^>]*>/g, \"\");\n  const contentLength = contentText.length;\n  if (contentLength >= 1000) {\n    score += 15; // 충분한 길이 (1000자 이상)\n  } else if (contentLength >= 500) {\n    score += 10; // 적절한 길이 (500-999자)\n  } else if (contentLength >= 300) {\n    score += 5; // 최소 길이 (300-499자)\n  } else {\n    score += 2; // 너무 짧음\n  }\n\n  // 4. H1 태그 최적화 (10점)\n  const h1Matches = content.match(/<h1[^>]*>(.*?)<\\/h1>/gi) || [];\n  const h1Count = h1Matches.length;\n  if (h1Count === 1) {\n    score += 10; // H1이 정확히 1개\n  } else if (h1Count === 0) {\n    // H1이 없으면 H2의 첫 번째를 확인\n    const h2Matches = content.match(/<h2[^>]*>(.*?)<\\/h2>/gi) || [];\n    if (h2Matches.length > 0) {\n      score += 5; // H2는 있지만 H1이 없음\n    }\n  } else {\n    score += 3; // H1이 여러 개 (감점)\n  }\n\n  // 5. H2 태그 구조 (10점)\n  const h2Matches = content.match(/<h2[^>]*>(.*?)<\\/h2>/gi) || [];\n  const h2Count = h2Matches.length;\n  if (h2Count >= 3) {\n    score += 10; // H2가 3개 이상 (좋은 구조)\n  } else if (h2Count >= 1) {\n    score += 5; // H2가 1-2개\n  }\n\n  // 6. 이미지 Alt 텍스트 최적화 (10점)\n  if (images.length > 0) {\n    const imagesWithAlt = images.filter(\n      (img) => img.alt && String(img.alt).trim().length > 0\n    ).length;\n    const altScore = (imagesWithAlt / images.length) * 10;\n    score += Math.round(altScore);\n  }\n\n  // 7. 키워드 밀도 (10점)\n  const contentTextLower = contentText.toLowerCase();\n  const wordCount = contentTextLower\n    .split(/\\s+/)\n    .filter((w) => w.length > 0).length;\n\n  if (primaryKeyword && wordCount > 0) {\n    const keywordWords = primaryKeyword\n      .toLowerCase()\n      .split(\" \")\n      .filter((w) => w.length > 2);\n    let totalKeywordCount = 0;\n\n    keywordWords.forEach((word) => {\n      const regex = new RegExp(`\\\\b${word}\\\\b`, \"gi\");\n      const matches = contentTextLower.match(regex);\n      totalKeywordCount += matches ? matches.length : 0;\n    });\n\n    const keywordDensity =\n      wordCount > 0 ? (totalKeywordCount / wordCount) * 100 : 0;\n\n    if (keywordDensity >= 0.5 && keywordDensity <= 2.5) {\n      score += 10; // 적절한 밀도 (0.5-2.5%)\n    } else if (keywordDensity > 0 && keywordDensity < 0.5) {\n      score += 5; // 너무 낮음\n    } else if (keywordDensity > 2.5 && keywordDensity <= 4) {\n      score += 7; // 약간 높음\n    } else {\n      score += 3; // 너무 높거나 낮음\n    }\n  } else {\n    score += 5; // 키워드가 없으면 기본 점수\n  }\n\n  // 8. 첫 문단에 키워드 포함 (10점)\n  const firstParagraph = contentText.substring(0, 200).toLowerCase();\n  if (primaryKeyword) {\n    const keywordWords = primaryKeyword\n      .toLowerCase()\n      .split(\" \")\n      .filter((w) => w.length > 2);\n    const hasKeywordInFirst = keywordWords.some((word) =>\n      firstParagraph.includes(word)\n    );\n    if (hasKeywordInFirst) {\n      score += 10; // 첫 문단에 키워드 포함\n    } else {\n      score += 3; // 포함되지 않음\n    }\n  } else {\n    score += 5; // 키워드가 없으면 기본 점수\n  }\n\n  return Math.min(Math.round(score), maxScore);\n}\n\nexport async function POST(req: Request) {\n  try {\n    // API 키 확인\n    if (!apiKey) {\n      return NextResponse.json(\n        {\n          success: false,\n          error:\n            \"Gemini API 키가 설정되지 않았습니다. .env.local 파일에 GEMINI_API_KEY, GOOGLE_GEMINI_API_KEY, 또는 GOOGLE_API_KEY 중 하나를 설정해주세요.\",\n        },\n        { status: 500 }\n      );\n    }\n\n    // 프론트엔드에서 보내는 모든 파라미터 받기\n    const { modelName, modelAlias, templateType, includeImages, modelInfo } =\n      await req.json();\n\n    if (!modelName) {\n      return NextResponse.json(\n        {\n          success: false,\n          error: \"모델명이 입력되지 않았습니다.\",\n        },\n        { status: 400 }\n      );\n    }\n\n    // WordPress 환경 변수 확인은 프론트엔드에서 저장할 때 필요하므로 여기서는 선택적\n    // 콘텐츠 생성만 하므로 WordPress 설정이 없어도 진행 가능\n\n    // ---------------------------------------------------------\n    // STEP 1: 검색 (Tavily)\n    // ---------------------------------------------------------\n    console.log(`[1/3] Searching for: ${modelName}...`);\n\n    const tavilyApiKey = process.env.TAVILY_API_KEY;\n    if (!tavilyApiKey) {\n      console.warn(\n        \"Tavily API 키가 설정되지 않았습니다. 검색 없이 진행합니다.\"\n      );\n    }\n\n    let searchContext = \"\";\n    if (tavilyApiKey) {\n      try {\n        const searchResponse = await fetch(\"https://api.tavily.com/search\", {\n          method: \"POST\",\n          headers: { \"Content-Type\": \"application/json\" },\n          body: JSON.stringify({\n            api_key: tavilyApiKey,\n            query: `${modelName} vintage watch history specs price user review`,\n            search_depth: \"basic\",\n            include_answer: true,\n            max_results: 5,\n          }),\n        });\n\n        if (!searchResponse.ok) {\n          const errorText = await searchResponse.text();\n          console.error(\"Tavily API 오류:\", errorText);\n          throw new Error(`Tavily 검색 실패: ${errorText}`);\n        }\n\n        const searchData = await searchResponse.json();\n\n        if (searchData.results && searchData.results.length > 0) {\n          searchContext = searchData.results\n            .map((result: any) => `[제목: ${result.title}] ${result.content}`)\n            .join(\"\\n\\n\");\n        } else {\n          console.warn(\"Tavily 검색 결과가 없습니다.\");\n        }\n      } catch (error: any) {\n        console.error(\"Tavily 검색 오류:\", error);\n        // 검색 실패해도 계속 진행\n      }\n    }\n\n    // ---------------------------------------------------------\n    // STEP 2: Gemini 글 작성 (구조화된 JSON 요청)\n    // ---------------------------------------------------------\n    console.log(`[2/3] Generating structured content with Gemini...`);\n\n    // 모델 정보 활용\n    const displayName = modelAlias || modelName;\n    const brand = modelInfo?.brand || \"\";\n    const modelNameFull = modelInfo?.modelName || modelName;\n\n    const prompt = `\n      모델명: ${displayName}\n      ${brand ? `브랜드: ${brand}` : \"\"}\n      ${searchContext ? `[검색된 정보]: ${searchContext}` : \"\"}\n      위 정보를 바탕으로 독자가 읽기 편하게 섹션을 나누어 작성해주세요.\n      ${\n        templateType === \"detailed_review\"\n          ? \"상세 리뷰 형식으로 작성해주세요.\"\n          : \"\"\n      }\n      ${templateType === \"comparison\" ? \"비교 분석 형식으로 작성해주세요.\" : \"\"}\n      ${templateType === \"history\" ? \"역사 및 배경 형식으로 작성해주세요.\" : \"\"}\n    `;\n\n    // 시스템 프롬프트\n    const systemInstruction = `\n      당신은 40대 남성 빈티지 시계 전문 블로거입니다.\n      검색된 정보를 바탕으로 블로그 글을 작성합니다.\n      \n      [필수 지침]\n      1. 어조: \"~했습니다\", \"~하죠\", \"~느껴집니다\" (경험담 스타일)\n      2. 구조: 제목 -> 서론 -> 스펙(리스트) -> 특징/역사 -> 착용감(중요) -> 결론\n      3. SEO: 소제목(h2)을 적절히 배치하여 계층 구조를 잡을 것.\n      \n      [출력 데이터 구조 (중요)]\n      반드시 아래 JSON 스키마를 따르세요. 'sections' 배열에 문단별로 내용을 나누어 담으세요.\n      type은 \"h1\", \"h2\", \"h3\", \"p\", \"ul\" 중 하나여야 합니다. \"ul\"일 경우 content는 문자열 배열이어야 합니다.\n      첫 번째 섹션은 반드시 \"h1\" 타입으로 제목을 포함해야 합니다. (SEO 최적화를 위해)\n\n      {\n        \"title\": \"블로그 제목\",\n        \"sections\": [\n          { \"type\": \"h1\", \"content\": \"블로그 제목\" },\n          { \"type\": \"p\", \"content\": \"서론 내용...\" },\n          { \"type\": \"h2\", \"content\": \"소제목 (예: 역사와 유래)\" },\n          { \"type\": \"p\", \"content\": \"본문 내용...\" },\n          { \"type\": \"ul\", \"content\": [\"스펙1\", \"스펙2\", \"스펙3\"] },\n          { \"type\": \"h2\", \"content\": \"실착 후기\" },\n          { \"type\": \"p\", \"content\": \"착용감 내용...\" }\n        ]\n      }\n    `;\n\n    // 모델 선택: 실제 사용 가능한 모델을 동적으로 확인\n    let modelOptions: string[] = [];\n\n    try {\n      // ListModels API를 통해 사용 가능한 모델 확인\n      const modelsResponse = await fetch(\n        `https://generativelanguage.googleapis.com/v1beta/models?key=${apiKey}`\n      );\n\n      if (modelsResponse.ok) {\n        const modelsData = await modelsResponse.json();\n        const availableModels = (modelsData.models || [])\n          .filter(\n            (m: any) =>\n              m.name &&\n              m.supportedGenerationMethods?.includes(\"generateContent\") &&\n              m.name.includes(\"gemini\") &&\n              !m.name.includes(\"exp\") && // 실험적 모델 제외\n              !m.name.includes(\"preview\") && // 프리뷰 모델 제외\n              !m.name.includes(\"image\") && // 이미지 전용 모델 제외\n              !m.name.includes(\"tts\") && // TTS 전용 모델 제외\n              !m.name.includes(\"robotics\") && // 로봇 전용 모델 제외\n              !m.name.includes(\"computer-use\") // 컴퓨터 사용 전용 모델 제외\n          )\n          .map((m: any) => m.name.replace(\"models/\", \"\")) // \"models/\" 접두사 제거\n          .sort((a: string, b: string) => {\n            // 우선순위: 2.5 > 2.0 > latest, flash > pro\n            const getPriority = (name: string) => {\n              if (name.includes(\"2.5\")) return 1;\n              if (name.includes(\"2.0\")) return 2;\n              if (name.includes(\"latest\")) return 3;\n              return 4;\n            };\n            return getPriority(a) - getPriority(b);\n          });\n\n        if (availableModels.length > 0) {\n          modelOptions = availableModels;\n          console.log(\"✅ 사용 가능한 모델 발견:\", modelOptions);\n        } else {\n          throw new Error(\"사용 가능한 Gemini 모델을 찾을 수 없습니다.\");\n        }\n      } else {\n        throw new Error(`모델 목록 조회 실패: ${modelsResponse.status}`);\n      }\n    } catch (error: any) {\n      console.warn(\"⚠️ 모델 목록 확인 실패, 기본 모델 사용:\", error.message);\n      // 폴백: 실제 확인된 모델 목록 사용\n      modelOptions = [\n        \"gemini-2.5-flash\",\n        \"gemini-2.5-pro\",\n        \"gemini-2.0-flash\",\n        \"gemini-2.0-flash-001\",\n        \"gemini-flash-latest\",\n        \"gemini-pro-latest\",\n      ];\n    }\n\n    let aiOutput;\n    let lastError: Error | null = null;\n\n    // 모델을 순차적으로 시도하여 실제로 사용 가능한 모델 찾기\n    for (const modelNameOption of modelOptions) {\n      try {\n        console.log(`모델 시도: ${modelNameOption}`);\n\n        const model = genAI.getGenerativeModel({\n          model: modelNameOption,\n          generationConfig: {\n            responseMimeType: \"application/json\",\n          },\n          systemInstruction: systemInstruction,\n        });\n\n        const result = await model.generateContent(prompt);\n        const responseText = result.response.text();\n\n        // JSON 파싱 시도\n        try {\n          aiOutput = JSON.parse(responseText);\n        } catch (parseError) {\n          console.error(\"JSON 파싱 오류:\", parseError);\n          console.error(\"응답 텍스트:\", responseText);\n          throw new Error(\n            \"AI 응답을 JSON으로 파싱할 수 없습니다. 응답 형식을 확인해주세요.\"\n          );\n        }\n\n        // 응답 구조 검증\n        if (!aiOutput || typeof aiOutput !== \"object\") {\n          throw new Error(\"AI 응답이 올바른 형식이 아닙니다.\");\n        }\n\n        if (!aiOutput.title || typeof aiOutput.title !== \"string\") {\n          throw new Error(\"AI 응답에 제목(title)이 없거나 올바르지 않습니다.\");\n        }\n\n        if (\n          !aiOutput.sections ||\n          !Array.isArray(aiOutput.sections) ||\n          aiOutput.sections.length === 0\n        ) {\n          throw new Error(\n            \"AI 응답에 섹션(sections)이 없거나 올바르지 않습니다.\"\n          );\n        }\n\n        console.log(`✅ 모델 ${modelNameOption} 성공!`);\n        break; // 성공하면 루프 종료\n      } catch (error: any) {\n        console.warn(`❌ 모델 ${modelNameOption} 실패:`, error.message);\n        lastError = error;\n\n        // 429 오류 (할당량 초과) - 명확한 메시지와 함께 즉시 중단\n        if (\n          error.message?.includes(\"429\") ||\n          error.message?.includes(\"quota\") ||\n          error.message?.includes(\"Too Many Requests\")\n        ) {\n          throw new Error(\n            `API 할당량을 초과했습니다. 무료 티어의 일일/분당 요청 한도에 도달했습니다. 잠시 후 다시 시도해주세요. (모델: ${modelNameOption})`\n          );\n        }\n\n        // 401/403 오류 (인증 문제) - 즉시 중단\n        if (\n          error.message?.includes(\"401\") ||\n          error.message?.includes(\"403\") ||\n          error.message?.includes(\"API key\") ||\n          error.message?.includes(\"authentication\")\n        ) {\n          throw new Error(\n            `API 키 인증에 실패했습니다. .env.local 파일의 GEMINI_API_KEY를 확인해주세요. (모델: ${modelNameOption})`\n          );\n        }\n\n        // 404 오류가 아니면 즉시 중단 (다른 종류의 오류)\n        if (\n          !error.message?.includes(\"404\") &&\n          !error.message?.includes(\"not found\") &&\n          !error.message?.includes(\"is not found for API version\")\n        ) {\n          throw error;\n        }\n\n        continue; // 404 오류만 다음 모델 시도\n      }\n    }\n\n    // 모든 모델 실패 시\n    if (!aiOutput) {\n      const errorMessage = lastError?.message || \"알 수 없는 오류\";\n      throw new Error(\n        `사용 가능한 Gemini 모델을 찾을 수 없습니다. 시도한 모델: ${modelOptions.join(\n          \", \"\n        )}. 마지막 오류: ${errorMessage}\\n\\n해결 방법:\\n1. Google AI Studio (https://aistudio.google.com)에서 API 키가 유효한지 확인하세요.\\n2. API 키에 충분한 할당량이 있는지 확인하세요.\\n3. .env.local 파일의 GEMINI_API_KEY가 올바르게 설정되어 있는지 확인하세요.`\n      );\n    }\n\n    // ---------------------------------------------------------\n    // STEP 3: 워드프레스 블록 포맷으로 변환\n    // ---------------------------------------------------------\n    console.log(`[3/3] Converting to WordPress format...`);\n\n    // 여기서 JSON -> 워드프레스 HTML 주석 포맷으로 변환\n    const blockContent = convertToWPBlocks(aiOutput.sections);\n\n    // WordPress에 저장 (프론트엔드가 별도로 저장하므로 여기서는 저장하지 않음)\n    // 대신 생성된 콘텐츠 데이터를 반환\n\n    // 공백 제외 글자 수 계산\n    const contentText = blockContent.replace(/<[^>]*>/g, \"\");\n    const wordCount = contentText.replace(/\\s/g, \"\").length;\n\n    // 이미지 배열 생성 (includeImages가 true일 때만)\n    const imageTypes = [\"front\", \"side\", \"back\"] as const;\n    const images = includeImages\n      ? imageTypes.map((type) => ({\n          url: `/placeholder.svg?height=400&width=400&query=${encodeURIComponent(\n            `${displayName} watch ${type}`\n          )}`,\n          alt: `${displayName} ${\n            type === \"front\" ? \"전면\" : type === \"side\" ? \"측면\" : \"후면\"\n          }`,\n        }))\n      : [];\n\n    // 메타 설명 생성\n    const metaDescription = `${displayName}의 완벽 리뷰. 디자인, 스펙, 무브먼트, 착용감까지 상세 분석. 구매 전 꼭 확인하세요.`;\n\n    // 태그 생성\n    const tags = [\n      brand || \"시계\",\n      modelNameFull,\n      \"시계 리뷰\",\n      \"럭셔리 워치\",\n      \"명품 시계\",\n    ].filter(Boolean);\n\n    // SEO 점수 계산 (실제 SEO 요소 기반)\n    const keywords = [\n      String(displayName),\n      `${String(brand)} ${String(modelNameFull)}`,\n      String(modelNameFull),\n    ];\n    const seoScore = calculateSEOScore(\n      aiOutput.title,\n      metaDescription,\n      blockContent,\n      images,\n      keywords\n    );\n\n    // 프론트엔드가 기대하는 형식으로 반환\n    return NextResponse.json({\n      success: true,\n      data: {\n        title: aiOutput.title,\n        content: blockContent,\n        metaDescription,\n        tags,\n        wordCount,\n        seoScore, // 계산된 SEO 점수 사용\n        images,\n      },\n    });\n  } catch (error: any) {\n    console.error(\"Error:\", error);\n    return NextResponse.json(\n      { success: false, error: error.message },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,4BAA4B;AAC5B,wEAAwE;AACxE,MAAM,SACJ,QAAQ,GAAG,CAAC,cAAc,IAC1B,QAAQ,GAAG,CAAC,qBAAqB,IACjC,QAAQ,GAAG,CAAC,cAAc,IAC1B;AAEF,IAAI,CAAC,QAAQ;IACX,QAAQ,KAAK,CACX;IAEF,QAAQ,KAAK,CAAC;IACd,QAAQ,KAAK,CAAC;IACd,QAAQ,KAAK,CAAC;AAChB;AAEA,MAAM,QAAQ,IAAI,gQAAkB,CAAC;AAQrC,2CAA2C;AAC3C,SAAS,kBAAkB,QAAmB;IAC5C,OAAO,SACJ,GAAG,CAAC,CAAC;QACJ,OAAQ,QAAQ,IAAI;YAClB,KAAK;gBACH,OAAO,CAAC,MAAM,EAAE,OAAO,QAAQ,OAAO,EAAE,OAAO,CAAC;YAElD,KAAK;gBACH,OAAO,CAAC,MAAM,EAAE,OAAO,QAAQ,OAAO,EAAE,OAAO,CAAC;YAElD,KAAK;gBACH,OAAO,CAAC,MAAM,EAAE,OAAO,QAAQ,OAAO,EAAE,OAAO,CAAC;YAElD,KAAK;gBACH,OAAO,CAAC,KAAK,EAAE,OAAO,QAAQ,OAAO,EAAE,MAAM,CAAC;YAEhD,KAAK;gBACH,aAAa;gBACb,MAAM,YAAY,MAAM,OAAO,CAAC,QAAQ,OAAO,IAC3C,QAAQ,OAAO,CAAC,GAAG,CAAC,CAAC,OAAiB,CAAC,IAAI,EAAE,KAAK,KAAK,CAAC,EAAE,IAAI,CAAC,MAC/D,CAAC,IAAI,EAAE,OAAO,QAAQ,OAAO,EAAE,KAAK,CAAC;gBACzC,OAAO,CAAC,MAAM,EAAE,UAAU,OAAO,CAAC;YAEpC;gBACE,OAAO,CAAC,KAAK,EAAE,OAAO,QAAQ,OAAO,EAAE,MAAM,CAAC;QAClD;IACF,GACC,IAAI,CAAC,SAAS,gBAAgB;AACnC;AAEA,8BAA8B;AAC9B,SAAS,kBACP,KAAa,EACb,eAAuB,EACvB,OAAe,EACf,MAA4C,EAC5C,QAAkB;IAElB,IAAI,QAAQ;IACZ,MAAM,WAAW;IAEjB,uBAAuB;IACvB,MAAM,iBAAiB,QAAQ,CAAC,EAAE,IAAI;IAEtC,kBAAkB;IAClB,MAAM,cAAc,MAAM,MAAM;IAChC,IAAI,eAAe,MAAM,eAAe,IAAI;QAC1C,SAAS,IAAI,iBAAiB;IAChC,OAAO,IAAI,cAAc,MAAM,eAAe,IAAI;QAChD,SAAS,GAAG,gBAAgB;IAC9B,OAAO,IAAI,cAAc,MAAM,cAAc,IAAI;QAC/C,SAAS,GAAG,QAAQ;IACtB,OAAO;QACL,SAAS,GAAG,WAAW;IACzB;IAEA,oBAAoB;IACpB,IACE,kBACA,MAAM,WAAW,GAAG,QAAQ,CAAC,eAAe,WAAW,KACvD;QACA,SAAS,IAAI,SAAS;IACxB,OAAO;QACL,wBAAwB;QACxB,MAAM,eAAe,eAAe,KAAK,CAAC,KAAK,MAAM,CAAC,CAAC,IAAM,EAAE,MAAM,GAAG;QACxE,MAAM,oBAAoB,aAAa,IAAI,CAAC,CAAC,OAC3C,MAAM,WAAW,GAAG,QAAQ,CAAC,KAAK,WAAW;QAE/C,IAAI,mBAAmB;YACrB,SAAS;QACX;IACF;IAEA,qBAAqB;IACrB,MAAM,aAAa,gBAAgB,MAAM;IACzC,IAAI,cAAc,OAAO,cAAc,KAAK;QAC1C,SAAS,IAAI,mBAAmB;IAClC,OAAO,IAAI,cAAc,OAAO,aAAa,KAAK;QAChD,SAAS,GAAG,QAAQ;IACtB,OAAO,IAAI,aAAa,OAAO,cAAc,KAAK;QAChD,SAAS,GAAG,OAAO;IACrB,OAAO;QACL,SAAS,GAAG,WAAW;IACzB;IAEA,uBAAuB;IACvB,IACE,kBACA,gBAAgB,WAAW,GAAG,QAAQ,CAAC,eAAe,WAAW,KACjE;QACA,SAAS,GAAG,SAAS;IACvB;IAEA,kBAAkB;IAClB,MAAM,cAAc,QAAQ,OAAO,CAAC,YAAY;IAChD,MAAM,gBAAgB,YAAY,MAAM;IACxC,IAAI,iBAAiB,MAAM;QACzB,SAAS,IAAI,oBAAoB;IACnC,OAAO,IAAI,iBAAiB,KAAK;QAC/B,SAAS,IAAI,oBAAoB;IACnC,OAAO,IAAI,iBAAiB,KAAK;QAC/B,SAAS,GAAG,mBAAmB;IACjC,OAAO;QACL,SAAS,GAAG,QAAQ;IACtB;IAEA,qBAAqB;IACrB,MAAM,YAAY,QAAQ,KAAK,CAAC,6BAA6B,EAAE;IAC/D,MAAM,UAAU,UAAU,MAAM;IAChC,IAAI,YAAY,GAAG;QACjB,SAAS,IAAI,aAAa;IAC5B,OAAO,IAAI,YAAY,GAAG;QACxB,uBAAuB;QACvB,MAAM,YAAY,QAAQ,KAAK,CAAC,6BAA6B,EAAE;QAC/D,IAAI,UAAU,MAAM,GAAG,GAAG;YACxB,SAAS,GAAG,iBAAiB;QAC/B;IACF,OAAO;QACL,SAAS,GAAG,gBAAgB;IAC9B;IAEA,oBAAoB;IACpB,MAAM,YAAY,QAAQ,KAAK,CAAC,6BAA6B,EAAE;IAC/D,MAAM,UAAU,UAAU,MAAM;IAChC,IAAI,WAAW,GAAG;QAChB,SAAS,IAAI,oBAAoB;IACnC,OAAO,IAAI,WAAW,GAAG;QACvB,SAAS,GAAG,WAAW;IACzB;IAEA,2BAA2B;IAC3B,IAAI,OAAO,MAAM,GAAG,GAAG;QACrB,MAAM,gBAAgB,OAAO,MAAM,CACjC,CAAC,MAAQ,IAAI,GAAG,IAAI,OAAO,IAAI,GAAG,EAAE,IAAI,GAAG,MAAM,GAAG,GACpD,MAAM;QACR,MAAM,WAAW,AAAC,gBAAgB,OAAO,MAAM,GAAI;QACnD,SAAS,KAAK,KAAK,CAAC;IACtB;IAEA,kBAAkB;IAClB,MAAM,mBAAmB,YAAY,WAAW;IAChD,MAAM,YAAY,iBACf,KAAK,CAAC,OACN,MAAM,CAAC,CAAC,IAAM,EAAE,MAAM,GAAG,GAAG,MAAM;IAErC,IAAI,kBAAkB,YAAY,GAAG;QACnC,MAAM,eAAe,eAClB,WAAW,GACX,KAAK,CAAC,KACN,MAAM,CAAC,CAAC,IAAM,EAAE,MAAM,GAAG;QAC5B,IAAI,oBAAoB;QAExB,aAAa,OAAO,CAAC,CAAC;YACpB,MAAM,QAAQ,IAAI,OAAO,CAAC,GAAG,EAAE,KAAK,GAAG,CAAC,EAAE;YAC1C,MAAM,UAAU,iBAAiB,KAAK,CAAC;YACvC,qBAAqB,UAAU,QAAQ,MAAM,GAAG;QAClD;QAEA,MAAM,iBACJ,YAAY,IAAI,AAAC,oBAAoB,YAAa,MAAM;QAE1D,IAAI,kBAAkB,OAAO,kBAAkB,KAAK;YAClD,SAAS,IAAI,oBAAoB;QACnC,OAAO,IAAI,iBAAiB,KAAK,iBAAiB,KAAK;YACrD,SAAS,GAAG,QAAQ;QACtB,OAAO,IAAI,iBAAiB,OAAO,kBAAkB,GAAG;YACtD,SAAS,GAAG,QAAQ;QACtB,OAAO;YACL,SAAS,GAAG,YAAY;QAC1B;IACF,OAAO;QACL,SAAS,GAAG,iBAAiB;IAC/B;IAEA,wBAAwB;IACxB,MAAM,iBAAiB,YAAY,SAAS,CAAC,GAAG,KAAK,WAAW;IAChE,IAAI,gBAAgB;QAClB,MAAM,eAAe,eAClB,WAAW,GACX,KAAK,CAAC,KACN,MAAM,CAAC,CAAC,IAAM,EAAE,MAAM,GAAG;QAC5B,MAAM,oBAAoB,aAAa,IAAI,CAAC,CAAC,OAC3C,eAAe,QAAQ,CAAC;QAE1B,IAAI,mBAAmB;YACrB,SAAS,IAAI,eAAe;QAC9B,OAAO;YACL,SAAS,GAAG,UAAU;QACxB;IACF,OAAO;QACL,SAAS,GAAG,iBAAiB;IAC/B;IAEA,OAAO,KAAK,GAAG,CAAC,KAAK,KAAK,CAAC,QAAQ;AACrC;AAEO,eAAe,KAAK,GAAY;IACrC,IAAI;QACF,WAAW;QACX,IAAI,CAAC,QAAQ;YACX,OAAO,+QAAY,CAAC,IAAI,CACtB;gBACE,SAAS;gBACT,OACE;YACJ,GACA;gBAAE,QAAQ;YAAI;QAElB;QAEA,yBAAyB;QACzB,MAAM,EAAE,SAAS,EAAE,UAAU,EAAE,YAAY,EAAE,aAAa,EAAE,SAAS,EAAE,GACrE,MAAM,IAAI,IAAI;QAEhB,IAAI,CAAC,WAAW;YACd,OAAO,+QAAY,CAAC,IAAI,CACtB;gBACE,SAAS;gBACT,OAAO;YACT,GACA;gBAAE,QAAQ;YAAI;QAElB;QAEA,mDAAmD;QACnD,sCAAsC;QAEtC,4DAA4D;QAC5D,sBAAsB;QACtB,4DAA4D;QAC5D,QAAQ,GAAG,CAAC,CAAC,qBAAqB,EAAE,UAAU,GAAG,CAAC;QAElD,MAAM,eAAe,QAAQ,GAAG,CAAC,cAAc;QAC/C,IAAI,CAAC,cAAc;YACjB,QAAQ,IAAI,CACV;QAEJ;QAEA,IAAI,gBAAgB;QACpB,IAAI,cAAc;YAChB,IAAI;gBACF,MAAM,iBAAiB,MAAM,MAAM,iCAAiC;oBAClE,QAAQ;oBACR,SAAS;wBAAE,gBAAgB;oBAAmB;oBAC9C,MAAM,KAAK,SAAS,CAAC;wBACnB,SAAS;wBACT,OAAO,GAAG,UAAU,8CAA8C,CAAC;wBACnE,cAAc;wBACd,gBAAgB;wBAChB,aAAa;oBACf;gBACF;gBAEA,IAAI,CAAC,eAAe,EAAE,EAAE;oBACtB,MAAM,YAAY,MAAM,eAAe,IAAI;oBAC3C,QAAQ,KAAK,CAAC,kBAAkB;oBAChC,MAAM,IAAI,MAAM,CAAC,cAAc,EAAE,WAAW;gBAC9C;gBAEA,MAAM,aAAa,MAAM,eAAe,IAAI;gBAE5C,IAAI,WAAW,OAAO,IAAI,WAAW,OAAO,CAAC,MAAM,GAAG,GAAG;oBACvD,gBAAgB,WAAW,OAAO,CAC/B,GAAG,CAAC,CAAC,SAAgB,CAAC,KAAK,EAAE,OAAO,KAAK,CAAC,EAAE,EAAE,OAAO,OAAO,EAAE,EAC9D,IAAI,CAAC;gBACV,OAAO;oBACL,QAAQ,IAAI,CAAC;gBACf;YACF,EAAE,OAAO,OAAY;gBACnB,QAAQ,KAAK,CAAC,iBAAiB;YAC/B,gBAAgB;YAClB;QACF;QAEA,4DAA4D;QAC5D,qCAAqC;QACrC,4DAA4D;QAC5D,QAAQ,GAAG,CAAC,CAAC,kDAAkD,CAAC;QAEhE,WAAW;QACX,MAAM,cAAc,cAAc;QAClC,MAAM,QAAQ,WAAW,SAAS;QAClC,MAAM,gBAAgB,WAAW,aAAa;QAE9C,MAAM,SAAS,CAAC;WACT,EAAE,YAAY;MACnB,EAAE,QAAQ,CAAC,KAAK,EAAE,OAAO,GAAG,GAAG;MAC/B,EAAE,gBAAgB,CAAC,UAAU,EAAE,eAAe,GAAG,GAAG;;MAEpD,EACE,iBAAiB,oBACb,uBACA,GACL;MACD,EAAE,iBAAiB,eAAe,uBAAuB,GAAG;MAC5D,EAAE,iBAAiB,YAAY,yBAAyB,GAAG;IAC7D,CAAC;QAED,WAAW;QACX,MAAM,oBAAoB,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;IA0B3B,CAAC;QAED,+BAA+B;QAC/B,IAAI,eAAyB,EAAE;QAE/B,IAAI;YACF,kCAAkC;YAClC,MAAM,iBAAiB,MAAM,MAC3B,CAAC,4DAA4D,EAAE,QAAQ;YAGzE,IAAI,eAAe,EAAE,EAAE;gBACrB,MAAM,aAAa,MAAM,eAAe,IAAI;gBAC5C,MAAM,kBAAkB,CAAC,WAAW,MAAM,IAAI,EAAE,EAC7C,MAAM,CACL,CAAC,IACC,EAAE,IAAI,IACN,EAAE,0BAA0B,EAAE,SAAS,sBACvC,EAAE,IAAI,CAAC,QAAQ,CAAC,aAChB,CAAC,EAAE,IAAI,CAAC,QAAQ,CAAC,UAAU,YAAY;oBACvC,CAAC,EAAE,IAAI,CAAC,QAAQ,CAAC,cAAc,YAAY;oBAC3C,CAAC,EAAE,IAAI,CAAC,QAAQ,CAAC,YAAY,eAAe;oBAC5C,CAAC,EAAE,IAAI,CAAC,QAAQ,CAAC,UAAU,eAAe;oBAC1C,CAAC,EAAE,IAAI,CAAC,QAAQ,CAAC,eAAe,cAAc;oBAC9C,CAAC,EAAE,IAAI,CAAC,QAAQ,CAAC,gBAAgB,kBAAkB;kBAEtD,GAAG,CAAC,CAAC,IAAW,EAAE,IAAI,CAAC,OAAO,CAAC,WAAW,KAAK,mBAAmB;iBAClE,IAAI,CAAC,CAAC,GAAW;oBAChB,wCAAwC;oBACxC,MAAM,cAAc,CAAC;wBACnB,IAAI,KAAK,QAAQ,CAAC,QAAQ,OAAO;wBACjC,IAAI,KAAK,QAAQ,CAAC,QAAQ,OAAO;wBACjC,IAAI,KAAK,QAAQ,CAAC,WAAW,OAAO;wBACpC,OAAO;oBACT;oBACA,OAAO,YAAY,KAAK,YAAY;gBACtC;gBAEF,IAAI,gBAAgB,MAAM,GAAG,GAAG;oBAC9B,eAAe;oBACf,QAAQ,GAAG,CAAC,mBAAmB;gBACjC,OAAO;oBACL,MAAM,IAAI,MAAM;gBAClB;YACF,OAAO;gBACL,MAAM,IAAI,MAAM,CAAC,aAAa,EAAE,eAAe,MAAM,EAAE;YACzD;QACF,EAAE,OAAO,OAAY;YACnB,QAAQ,IAAI,CAAC,6BAA6B,MAAM,OAAO;YACvD,sBAAsB;YACtB,eAAe;gBACb;gBACA;gBACA;gBACA;gBACA;gBACA;aACD;QACH;QAEA,IAAI;QACJ,IAAI,YAA0B;QAE9B,kCAAkC;QAClC,KAAK,MAAM,mBAAmB,aAAc;YAC1C,IAAI;gBACF,QAAQ,GAAG,CAAC,CAAC,OAAO,EAAE,iBAAiB;gBAEvC,MAAM,QAAQ,MAAM,kBAAkB,CAAC;oBACrC,OAAO;oBACP,kBAAkB;wBAChB,kBAAkB;oBACpB;oBACA,mBAAmB;gBACrB;gBAEA,MAAM,SAAS,MAAM,MAAM,eAAe,CAAC;gBAC3C,MAAM,eAAe,OAAO,QAAQ,CAAC,IAAI;gBAEzC,aAAa;gBACb,IAAI;oBACF,WAAW,KAAK,KAAK,CAAC;gBACxB,EAAE,OAAO,YAAY;oBACnB,QAAQ,KAAK,CAAC,eAAe;oBAC7B,QAAQ,KAAK,CAAC,WAAW;oBACzB,MAAM,IAAI,MACR;gBAEJ;gBAEA,WAAW;gBACX,IAAI,CAAC,YAAY,OAAO,aAAa,UAAU;oBAC7C,MAAM,IAAI,MAAM;gBAClB;gBAEA,IAAI,CAAC,SAAS,KAAK,IAAI,OAAO,SAAS,KAAK,KAAK,UAAU;oBACzD,MAAM,IAAI,MAAM;gBAClB;gBAEA,IACE,CAAC,SAAS,QAAQ,IAClB,CAAC,MAAM,OAAO,CAAC,SAAS,QAAQ,KAChC,SAAS,QAAQ,CAAC,MAAM,KAAK,GAC7B;oBACA,MAAM,IAAI,MACR;gBAEJ;gBAEA,QAAQ,GAAG,CAAC,CAAC,KAAK,EAAE,gBAAgB,IAAI,CAAC;gBACzC,OAAO,aAAa;YACtB,EAAE,OAAO,OAAY;gBACnB,QAAQ,IAAI,CAAC,CAAC,KAAK,EAAE,gBAAgB,IAAI,CAAC,EAAE,MAAM,OAAO;gBACzD,YAAY;gBAEZ,sCAAsC;gBACtC,IACE,MAAM,OAAO,EAAE,SAAS,UACxB,MAAM,OAAO,EAAE,SAAS,YACxB,MAAM,OAAO,EAAE,SAAS,sBACxB;oBACA,MAAM,IAAI,MACR,CAAC,kEAAkE,EAAE,gBAAgB,CAAC,CAAC;gBAE3F;gBAEA,6BAA6B;gBAC7B,IACE,MAAM,OAAO,EAAE,SAAS,UACxB,MAAM,OAAO,EAAE,SAAS,UACxB,MAAM,OAAO,EAAE,SAAS,cACxB,MAAM,OAAO,EAAE,SAAS,mBACxB;oBACA,MAAM,IAAI,MACR,CAAC,8DAA8D,EAAE,gBAAgB,CAAC,CAAC;gBAEvF;gBAEA,gCAAgC;gBAChC,IACE,CAAC,MAAM,OAAO,EAAE,SAAS,UACzB,CAAC,MAAM,OAAO,EAAE,SAAS,gBACzB,CAAC,MAAM,OAAO,EAAE,SAAS,iCACzB;oBACA,MAAM;gBACR;gBAEA,UAAU,mBAAmB;YAC/B;QACF;QAEA,aAAa;QACb,IAAI,CAAC,UAAU;YACb,MAAM,eAAe,WAAW,WAAW;YAC3C,MAAM,IAAI,MACR,CAAC,qCAAqC,EAAE,aAAa,IAAI,CACvD,MACA,UAAU,EAAE,aAAa,yKAAyK,CAAC;QAEzM;QAEA,4DAA4D;QAC5D,2BAA2B;QAC3B,4DAA4D;QAC5D,QAAQ,GAAG,CAAC,CAAC,uCAAuC,CAAC;QAErD,oCAAoC;QACpC,MAAM,eAAe,kBAAkB,SAAS,QAAQ;QAExD,gDAAgD;QAChD,qBAAqB;QAErB,gBAAgB;QAChB,MAAM,cAAc,aAAa,OAAO,CAAC,YAAY;QACrD,MAAM,YAAY,YAAY,OAAO,CAAC,OAAO,IAAI,MAAM;QAEvD,sCAAsC;QACtC,MAAM,aAAa;YAAC;YAAS;YAAQ;SAAO;QAC5C,MAAM,SAAS,gBACX,WAAW,GAAG,CAAC,CAAC,OAAS,CAAC;gBACxB,KAAK,CAAC,4CAA4C,EAAE,mBAClD,GAAG,YAAY,OAAO,EAAE,MAAM,GAC7B;gBACH,KAAK,GAAG,YAAY,CAAC,EACnB,SAAS,UAAU,OAAO,SAAS,SAAS,OAAO,MACnD;YACJ,CAAC,KACD,EAAE;QAEN,WAAW;QACX,MAAM,kBAAkB,GAAG,YAAY,kDAAkD,CAAC;QAE1F,QAAQ;QACR,MAAM,OAAO;YACX,SAAS;YACT;YACA;YACA;YACA;SACD,CAAC,MAAM,CAAC;QAET,2BAA2B;QAC3B,MAAM,WAAW;YACf,OAAO;YACP,GAAG,OAAO,OAAO,CAAC,EAAE,OAAO,gBAAgB;YAC3C,OAAO;SACR;QACD,MAAM,WAAW,kBACf,SAAS,KAAK,EACd,iBACA,cACA,QACA;QAGF,sBAAsB;QACtB,OAAO,+QAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,MAAM;gBACJ,OAAO,SAAS,KAAK;gBACrB,SAAS;gBACT;gBACA;gBACA;gBACA;gBACA;YACF;QACF;IACF,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,UAAU;QACxB,OAAO,+QAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAAO,OAAO,MAAM,OAAO;QAAC,GACvC;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}