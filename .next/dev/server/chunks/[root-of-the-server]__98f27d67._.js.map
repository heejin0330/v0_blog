{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/cording/PJT_JAEHAN/v0_blog/app/api/wordpress/save-draft/route.ts"],"sourcesContent":["import { type NextRequest, NextResponse } from \"next/server\"\n\ninterface WordPressPostData {\n  title: string\n  content: string\n  status: \"draft\" | \"publish\" | \"pending\"\n  excerpt?: string\n  tags?: number[]\n  categories?: number[]\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    // .env 파일에서 우선적으로 가져오기\n    let siteUrl = process.env.WORDPRESS_SITE_URL\n    let username = process.env.WORDPRESS_USERNAME\n    let appPassword = process.env.WORDPRESS_APP_PASSWORD\n\n    // .env에 없으면 요청 본문에서 가져오기\n    const body = await request.json()\n    \n    // .env 값이 없거나 빈 문자열인 경우에만 body에서 가져오기\n    if (!siteUrl || siteUrl.trim() === \"\") {\n      siteUrl = body.siteUrl\n    }\n    if (!username || username.trim() === \"\") {\n      username = body.username\n    }\n    if (!appPassword || appPassword.trim() === \"\") {\n      appPassword = body.appPassword\n    }\n\n    const { title, content, metaDescription, tags } = body\n\n    // 최종적으로 설정이 모두 있는지 확인\n    if (!siteUrl || siteUrl.trim() === \"\" || !username || username.trim() === \"\" || !appPassword || appPassword.trim() === \"\") {\n      return NextResponse.json({ error: \"워드프레스 설정이 필요합니다. .env 파일 또는 요청 본문에 설정을 제공해주세요.\" }, { status: 400 })\n    }\n\n    const normalizedUrl = siteUrl.replace(/\\/$/, \"\")\n\n    // Create post data\n    const postData: WordPressPostData = {\n      title,\n      content,\n      status: \"draft\",\n      excerpt: metaDescription,\n    }\n\n    // Create the post\n    const response = await fetch(`${normalizedUrl}/wp-json/wp/v2/posts`, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        Authorization: `Basic ${Buffer.from(`${username}:${appPassword}`).toString(\"base64\")}`,\n      },\n      body: JSON.stringify(postData),\n    })\n\n    if (!response.ok) {\n      const errorText = await response.text()\n      console.error(\"WordPress post creation error:\", errorText)\n      return NextResponse.json({ error: \"포스트 저장에 실패했습니다.\" }, { status: 500 })\n    }\n\n    const post = await response.json()\n\n    return NextResponse.json({\n      success: true,\n      postId: post.id,\n      postUrl: post.link,\n      editUrl: `${normalizedUrl}/wp-admin/post.php?post=${post.id}&action=edit`,\n    })\n  } catch (error) {\n    console.error(\"Save draft error:\", error)\n    return NextResponse.json({ error: \"포스트 저장 중 오류가 발생했습니다.\" }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;;AAWO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,uBAAuB;QACvB,IAAI,UAAU,QAAQ,GAAG,CAAC,kBAAkB;QAC5C,IAAI,WAAW,QAAQ,GAAG,CAAC,kBAAkB;QAC7C,IAAI,cAAc,QAAQ,GAAG,CAAC,sBAAsB;QAEpD,yBAAyB;QACzB,MAAM,OAAO,MAAM,QAAQ,IAAI;QAE/B,sCAAsC;QACtC,IAAI,CAAC,WAAW,QAAQ,IAAI,OAAO,IAAI;YACrC,UAAU,KAAK,OAAO;QACxB;QACA,IAAI,CAAC,YAAY,SAAS,IAAI,OAAO,IAAI;YACvC,WAAW,KAAK,QAAQ;QAC1B;QACA,IAAI,CAAC,eAAe,YAAY,IAAI,OAAO,IAAI;YAC7C,cAAc,KAAK,WAAW;QAChC;QAEA,MAAM,EAAE,KAAK,EAAE,OAAO,EAAE,eAAe,EAAE,IAAI,EAAE,GAAG;QAElD,sBAAsB;QACtB,IAAI,CAAC,WAAW,QAAQ,IAAI,OAAO,MAAM,CAAC,YAAY,SAAS,IAAI,OAAO,MAAM,CAAC,eAAe,YAAY,IAAI,OAAO,IAAI;YACzH,OAAO,+QAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAiD,GAAG;gBAAE,QAAQ;YAAI;QACtG;QAEA,MAAM,gBAAgB,QAAQ,OAAO,CAAC,OAAO;QAE7C,mBAAmB;QACnB,MAAM,WAA8B;YAClC;YACA;YACA,QAAQ;YACR,SAAS;QACX;QAEA,kBAAkB;QAClB,MAAM,WAAW,MAAM,MAAM,GAAG,cAAc,oBAAoB,CAAC,EAAE;YACnE,QAAQ;YACR,SAAS;gBACP,gBAAgB;gBAChB,eAAe,CAAC,MAAM,EAAE,OAAO,IAAI,CAAC,GAAG,SAAS,CAAC,EAAE,aAAa,EAAE,QAAQ,CAAC,WAAW;YACxF;YACA,MAAM,KAAK,SAAS,CAAC;QACvB;QAEA,IAAI,CAAC,SAAS,EAAE,EAAE;YAChB,MAAM,YAAY,MAAM,SAAS,IAAI;YACrC,QAAQ,KAAK,CAAC,kCAAkC;YAChD,OAAO,+QAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAkB,GAAG;gBAAE,QAAQ;YAAI;QACvE;QAEA,MAAM,OAAO,MAAM,SAAS,IAAI;QAEhC,OAAO,+QAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,QAAQ,KAAK,EAAE;YACf,SAAS,KAAK,IAAI;YAClB,SAAS,GAAG,cAAc,wBAAwB,EAAE,KAAK,EAAE,CAAC,YAAY,CAAC;QAC3E;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,qBAAqB;QACnC,OAAO,+QAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAuB,GAAG;YAAE,QAAQ;QAAI;IAC5E;AACF"}}]
}